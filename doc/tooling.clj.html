<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>tooling.clj</title>
<meta name="generator" content="emacs 24.5.1; htmlfontify 0.21" />
<style type="text/css"><!--
body { font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  color: #ededed;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.default   { font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  color: #ededed;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.default a { font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  color: #ededed;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.variable-name   { color: #d8fa3c;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.variable-name a { color: #d8fa3c;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-9-face   { color: #d3d3d3;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-9-face a { color: #d3d3d3;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-8-face   { color: #6a5acd;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-8-face a { color: #6a5acd;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.string   { color: #61ce3c;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.string a { color: #61ce3c;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-7-face   { color: #ffa500;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-7-face a { color: #ffa500;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-6-face   { color: #add8e6;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-6-face a { color: #add8e6;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.clojure-character-face   { color: #61ce3c;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.clojure-character-face a { color: #61ce3c;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.constant   { color: #4c83ff;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.constant a { color: #4c83ff;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-5-face   { color: #00ff00;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-5-face a { color: #00ff00;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-4-face   { color: #ffff00;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-4-face a { color: #ffff00;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.function-name   { color: #ff1493;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.function-name a { color: #ff1493;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-3-face   { color: #ff1493;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-3-face a { color: #ff1493;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.clojure-keyword-face   { color: #4c83ff;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.clojure-keyword-face a { color: #4c83ff;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-2-face   { color: #006400;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-2-face a { color: #006400;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.doc   { font-style: italic;  color: #ffffff;  background: #1a1a1a;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-size: 11pt;  text-decoration: none; }
span.doc a { font-style: italic;  color: #ffffff;  background: #1a1a1a;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-size: 11pt;  text-decoration: underline; }
span.type   { color: #d8fa3c;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.type a { color: #d8fa3c;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.keyword   { color: #fbde2d;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.keyword a { color: #fbde2d;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
span.rainbow-delimiters-depth-1-face   { color: #8b0000;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: none; }
span.rainbow-delimiters-depth-1-face a { color: #8b0000;  font-family: DejaVu Sans Mono;  font-stretch: normal;  font-weight: 500;  font-style: normal;  background: #000000;  font-size: 11pt;  text-decoration: underline; }
 --></style>

    <script type="text/javascript"><!--
  // this function is needed to work around
  // a bug in IE related to element attributes
  function hasClass(obj)
  {
      var result = false;
      if (obj.getAttributeNode("class") != null)
      {
          result = obj.getAttributeNode("class").value;
      }
      return result;
  }

  function stripe(id)
  {
      // the flag we'll use to keep track of
      // whether the current row is odd or even
      var even = false;

      // if arguments are provided to specify the colors
      // of the even & odd rows, then use the them;
      // otherwise use the following defaults:
      var evenColor = arguments[1] ? arguments[1] : "#fff";
      var oddColor  = arguments[2] ? arguments[2] : "#ddd";

      // obtain a reference to the desired table
      // if no such table exists, abort
      var table = document.getElementById(id);
      if (! table) { return; }

      // by definition, tables can have more than one tbody
      // element, so we'll have to get the list of child
      // &lt;tbody&gt;s
      var tbodies = table.getElementsByTagName("tbody");

      // and iterate through them...
      for (var h = 0; h < tbodies.length; h++)
      {
          // find all the &lt;tr&gt; elements...
          var trs = tbodies[h].getElementsByTagName("tr");

          // ... and iterate through them
          for (var i = 0; i < trs.length; i++)
          {
              // avoid rows that have a class attribute
              // or backgroundColor style
              if (! hasClass(trs[i]) &&
                  ! trs[i].style.backgroundColor)
              {
                  // get all the cells in this row...
                  var tds = trs[i].getElementsByTagName("td");

                  // and iterate through them...
                  for (var j = 0; j < tds.length; j++)
                  {
                      var mytd = tds[j];

                      // avoid cells that have a class attribute
                      // or backgroundColor style
                      if (! hasClass(mytd) &&
                          ! mytd.style.backgroundColor)
                      {
                          mytd.style.backgroundColor =
                            even ? evenColor : oddColor;
                      }
                  }
              }
              // flip from odd to even, or vice-versa
              even =  ! even;
          }
      }
  }

  function toggle_invis( name )
  {
      var filter =
        { acceptNode:
          function( node )
          { var classname = node.id;
            if( classname )
            { var classbase = classname.substr( 0, name.length );
              if( classbase == name ) { return NodeFilter.FILTER_ACCEPT; } }
            return NodeFilter.FILTER_SKIP; } };
      var walker = document.createTreeWalker( document.body           ,
                                              NodeFilter.SHOW_ELEMENT ,
                                              filter                  ,
                                              false                   );
      while( walker.nextNode() )
      {
          var e = walker.currentNode;
          if( e.style.display == "none" ) { e.style.display = "inline"; }
          else                            { e.style.display = "none";   }
      }
  }
--> </script>
  </head>
  <body onload="stripe('index'); return true;">

<pre><span class="rainbow-delimiters-depth-1-face">(</span><span class="keyword">ns</span> <span class="type">autocomplete.tooling</span>
  <span class="doc">&quot;The machinery. First it deals with graph then with dichotomy.

  The last lines (from function project-and-select) define some handy
  functions to query the list in some fancy way.&quot;</span>
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="clojure-keyword-face">:use</span> <span class="type">clojure.test</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="clojure-keyword-face">:use</span> <span class="rainbow-delimiters-depth-3-face">[</span>autocomplete configuration projectors<span class="rainbow-delimiters-depth-3-face">]</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">assoc-not-nil</span>
    <span class="doc">&quot;assoc if val is not nil, returns the untouched map otherwise&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>map key val<span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-4-face">(</span>nil? val<span class="rainbow-delimiters-depth-4-face">)</span>
      map
      <span class="rainbow-delimiters-depth-4-face">(</span>assoc map key val<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="rainbow-delimiters-depth-4-face">}</span> <span class="rainbow-delimiters-depth-4-face">(</span>assoc-not-nil <span class="rainbow-delimiters-depth-5-face">{</span><span class="rainbow-delimiters-depth-5-face">}</span> <span class="clojure-keyword-face">:a</span> <span class="constant">nil</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-keyword-face">:a</span> 1<span class="rainbow-delimiters-depth-4-face">}</span> <span class="rainbow-delimiters-depth-4-face">(</span>assoc-not-nil <span class="rainbow-delimiters-depth-5-face">{</span><span class="rainbow-delimiters-depth-5-face">}</span> <span class="clojure-keyword-face">:a</span> 1<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="rainbow-delimiters-depth-4-face">}</span> <span class="rainbow-delimiters-depth-4-face">(</span>assoc-not-nil <span class="rainbow-delimiters-depth-5-face">{</span><span class="rainbow-delimiters-depth-5-face">}</span> <span class="clojure-keyword-face">:b</span> <span class="constant">nil</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">create-tuple</span>
    <span class="doc">&quot;Create the tuple, that's to say the element of the double-linked
  list used in the graph.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>id index previous next<span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-4-face">[</span>map <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> id <span class="clojure-keyword-face">:index</span> index<span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">]</span>
      <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">-&gt;</span> <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> id <span class="clojure-keyword-face">:index</span> index<span class="rainbow-delimiters-depth-5-face">}</span>
          <span class="rainbow-delimiters-depth-5-face">(</span>assoc-not-nil <span class="clojure-keyword-face">:previous</span> previous<span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="rainbow-delimiters-depth-5-face">(</span>assoc-not-nil <span class="clojure-keyword-face">:next</span> next<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-keyword-face">:id</span> 0, <span class="clojure-keyword-face">:index</span> 1, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\a</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\c</span><span class="rainbow-delimiters-depth-4-face">}</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>create-tuple 0 1 <span class="clojure-character-face">\a</span> <span class="clojure-character-face">\c</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-keyword-face">:id</span> 0, <span class="clojure-keyword-face">:index</span> 1, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-4-face">}</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>create-tuple 0 1 <span class="clojure-character-face">\a</span> <span class="constant">nil</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-keyword-face">:id</span> 0, <span class="clojure-keyword-face">:index</span> 1, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\c</span><span class="rainbow-delimiters-depth-4-face">}</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>create-tuple 0 1 <span class="constant">nil</span> <span class="clojure-character-face">\c</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">melt-letter</span>
    <span class="doc">&quot;The smallest treatement: take a letter, create a tuple and melt it
  into the substrate. &quot;</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>substrate id letter <span class="rainbow-delimiters-depth-4-face">[</span>previous index next<span class="rainbow-delimiters-depth-4-face">]</span><span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-4-face">[</span>key letter
          val <span class="rainbow-delimiters-depth-5-face">(</span>create-tuple id index previous next<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">]</span>
      <span class="rainbow-delimiters-depth-4-face">(</span>merge-with <span class="rainbow-delimiters-depth-5-face">(</span>comp flatten vector<span class="rainbow-delimiters-depth-5-face">)</span>
                  substrate
                  <span class="rainbow-delimiters-depth-5-face">(</span>assoc <span class="rainbow-delimiters-depth-6-face">{</span><span class="rainbow-delimiters-depth-6-face">}</span> key <span class="rainbow-delimiters-depth-6-face">(</span>list val<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-character-face">\a</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 1, <span class="clojure-keyword-face">:index</span> 0, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">}</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>melt-letter <span class="rainbow-delimiters-depth-5-face">{</span><span class="rainbow-delimiters-depth-5-face">}</span> 1 <span class="clojure-character-face">\a</span> <span class="rainbow-delimiters-depth-5-face">[</span><span class="constant">nil</span> 0 <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-5-face">]</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-character-face">\a</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 1 <span class="clojure-keyword-face">:index</span> 0 <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="clojure-character-face">\b</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 1 <span class="clojure-keyword-face">:index</span> 1 <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\a</span> <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\c</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">}</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>melt-letter <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-character-face">\a</span> '<span class="rainbow-delimiters-depth-6-face">(</span><span class="rainbow-delimiters-depth-7-face">{</span><span class="clojure-keyword-face">:id</span> 1 <span class="clojure-keyword-face">:index</span> 0 <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-7-face">}</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">}</span>
                      1 <span class="clojure-character-face">\b</span> <span class="rainbow-delimiters-depth-5-face">[</span><span class="clojure-character-face">\a</span> 1 <span class="clojure-character-face">\c</span><span class="rainbow-delimiters-depth-5-face">]</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-character-face">\c</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 1, <span class="clojure-keyword-face">:index</span> 2, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">}</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>melt-letter <span class="rainbow-delimiters-depth-5-face">{</span><span class="rainbow-delimiters-depth-5-face">}</span> 1 <span class="clojure-character-face">\c</span> <span class="rainbow-delimiters-depth-5-face">[</span><span class="clojure-character-face">\b</span> 2 <span class="constant">nil</span><span class="rainbow-delimiters-depth-5-face">]</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">melt-word</span>
    <span class="doc">&quot;Recur melt-letter for each letter of a word, hence melt a whole word
  into the substrate.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate id word<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>melt-word substrate id word <span class="rainbow-delimiters-depth-5-face">[</span><span class="constant">nil</span> 0 <span class="rainbow-delimiters-depth-6-face">(</span>second word<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">]</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate id <span class="rainbow-delimiters-depth-5-face">[</span>letter &amp; letters<span class="rainbow-delimiters-depth-5-face">]</span> <span class="rainbow-delimiters-depth-5-face">[</span>previous index next<span class="rainbow-delimiters-depth-5-face">]</span><span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-5-face">(</span>nil? letter<span class="rainbow-delimiters-depth-5-face">)</span>
       substrate
       <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">recur</span> <span class="rainbow-delimiters-depth-6-face">(</span>melt-letter substrate id letter <span class="rainbow-delimiters-depth-7-face">[</span>previous index next<span class="rainbow-delimiters-depth-7-face">]</span><span class="rainbow-delimiters-depth-6-face">)</span>
              id
              letters
              <span class="rainbow-delimiters-depth-6-face">[</span>letter <span class="rainbow-delimiters-depth-7-face">(</span>inc index<span class="rainbow-delimiters-depth-7-face">)</span> <span class="rainbow-delimiters-depth-7-face">(</span>second letters<span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">(</span>melt-word <span class="rainbow-delimiters-depth-5-face">{</span><span class="rainbow-delimiters-depth-5-face">}</span> 0 <span class="string">&quot;aba&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span>
         <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-character-face">\a</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 0, <span class="clojure-keyword-face">:index</span> 0, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span>
               <span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 0, <span class="clojure-keyword-face">:index</span> 2, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="clojure-character-face">\b</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 0, <span class="clojure-keyword-face">:index</span> 1, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\a</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">}</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">construct</span>
    <span class="doc">&quot;This public function constructs the substrate needed further for the
  autocompletion. Beware it doesn't remove duplicates of the list.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>list-of-words<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>construct list-of-words <span class="rainbow-delimiters-depth-5-face">{</span><span class="rainbow-delimiters-depth-5-face">}</span> 0<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span><span class="rainbow-delimiters-depth-5-face">[</span>word &amp; words<span class="rainbow-delimiters-depth-5-face">]</span> substrate id<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-5-face">(</span>nil? word<span class="rainbow-delimiters-depth-5-face">)</span>
       substrate
       <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">recur</span> words
              <span class="rainbow-delimiters-depth-6-face">(</span>melt-word substrate id word<span class="rainbow-delimiters-depth-6-face">)</span>
              <span class="rainbow-delimiters-depth-6-face">(</span>inc id<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">(</span>construct '<span class="rainbow-delimiters-depth-5-face">(</span><span class="string">&quot;ab&quot;</span> <span class="string">&quot;aba&quot;</span> <span class="string">&quot;cba&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span>
         <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-character-face">\a</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 0, <span class="clojure-keyword-face">:index</span> 0, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span>
               <span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 1, <span class="clojure-keyword-face">:index</span> 0, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span>
               <span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 1, <span class="clojure-keyword-face">:index</span> 2, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span>
               <span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 2, <span class="clojure-keyword-face">:index</span> 2, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="clojure-character-face">\b</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 0, <span class="clojure-keyword-face">:index</span> 1, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-6-face">}</span>
               <span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 1, <span class="clojure-keyword-face">:index</span> 1, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\a</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-6-face">}</span>
               <span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 2, <span class="clojure-keyword-face">:index</span> 1, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\c</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="clojure-character-face">\c</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:id</span> 2, <span class="clojure-keyword-face">:index</span> 0, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\b</span><span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">}</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">neighboor-tuple</span>
    <span class="doc">&quot;Return the next tuple in the given direction for a word.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>substrate direction tuple<span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span>first <span class="rainbow-delimiters-depth-4-face">(</span>filter #<span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-6-face">(</span>= <span class="rainbow-delimiters-depth-7-face">(</span><span class="rainbow-delimiters-depth-8-face">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-9-face">(</span>= direction <span class="clojure-keyword-face">:next</span><span class="rainbow-delimiters-depth-9-face">)</span> inc
                                   <span class="rainbow-delimiters-depth-9-face">(</span>= direction <span class="clojure-keyword-face">:previous</span><span class="rainbow-delimiters-depth-9-face">)</span> dec<span class="rainbow-delimiters-depth-8-face">)</span>
                             <span class="rainbow-delimiters-depth-8-face">(</span><span class="clojure-keyword-face">:index</span> tuple<span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span> <span class="rainbow-delimiters-depth-7-face">(</span><span class="clojure-keyword-face">:index</span> <span class="variable-name">%</span><span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span>
                         <span class="rainbow-delimiters-depth-6-face">(</span>= <span class="rainbow-delimiters-depth-7-face">(</span><span class="clojure-keyword-face">:id</span> tuple<span class="rainbow-delimiters-depth-7-face">)</span> <span class="rainbow-delimiters-depth-7-face">(</span><span class="clojure-keyword-face">:id</span> <span class="variable-name">%</span><span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
                   <span class="rainbow-delimiters-depth-5-face">(</span>get substrate <span class="rainbow-delimiters-depth-6-face">(</span>get tuple direction<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-keyword-face">:id</span> 4, <span class="clojure-keyword-face">:index</span> 3, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\a</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\space</span><span class="rainbow-delimiters-depth-4-face">}</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>neighboor-tuple <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                          <span class="clojure-keyword-face">:previous</span>
                          <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 4, <span class="clojure-keyword-face">:index</span> 4, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\m</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">{</span><span class="clojure-keyword-face">:id</span> 4, <span class="clojure-keyword-face">:index</span> 5, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\space</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\space</span><span class="rainbow-delimiters-depth-4-face">}</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>neighboor-tuple <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                          <span class="clojure-keyword-face">:next</span>
                          <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 4, <span class="clojure-keyword-face">:index</span> 4, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\m</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">unique-field</span>
    <span class="doc">&quot;If a letter appears more than once in a word, selection of words
  containing this letter will have duplicates. This function ensures
  each word can only appear once or nonce.

  Technically, it takes a list of map and make sure no two maps have the
  same value for a given key (the field).&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>field list<span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span>reduce <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">fn</span> <span class="rainbow-delimiters-depth-5-face">[</span>acc cur<span class="rainbow-delimiters-depth-5-face">]</span>
              <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-6-face">(</span>some #<span class="rainbow-delimiters-depth-7-face">(</span>= <span class="rainbow-delimiters-depth-8-face">(</span>get cur field<span class="rainbow-delimiters-depth-8-face">)</span> <span class="rainbow-delimiters-depth-8-face">(</span>get <span class="variable-name">%</span> field<span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span>
                        acc<span class="rainbow-delimiters-depth-6-face">)</span>
                acc
                <span class="rainbow-delimiters-depth-6-face">(</span>conj acc cur<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span>
            <span class="rainbow-delimiters-depth-4-face">[</span><span class="rainbow-delimiters-depth-4-face">]</span>
            list<span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:a</span> 1<span class="rainbow-delimiters-depth-5-face">}</span> <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:a</span> 2<span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>unique-field <span class="clojure-keyword-face">:a</span> '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:a</span> 1<span class="rainbow-delimiters-depth-6-face">}</span> <span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:a</span> 2<span class="rainbow-delimiters-depth-6-face">}</span> <span class="rainbow-delimiters-depth-6-face">{</span><span class="clojure-keyword-face">:a</span> 1<span class="rainbow-delimiters-depth-6-face">}</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">tuple-selection</span>
    <span class="doc">&quot;The first overload is syntactic sugar for manual use. The core logic lies within the second overlaod.

  Argument func is intended to be a function to verify the position of
  the letter inside the word. case-mode is a keyword (:strict or :relax)
  to make this functino case-sesitive or not.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate func letter<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>tuple-selection substrate
                      func
                      letter
                      <span class="rainbow-delimiters-depth-5-face">(</span><span class="clojure-keyword-face">:case</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate func letter case-mode<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">-&gt;&gt;</span> substrate
          keys
          <span class="rainbow-delimiters-depth-5-face">(</span>filter <span class="rainbow-delimiters-depth-6-face">(</span>case-match letter case-mode<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="rainbow-delimiters-depth-5-face">(</span>mapcat <span class="rainbow-delimiters-depth-6-face">(</span>partial get substrate<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="rainbow-delimiters-depth-5-face">(</span>unique-field <span class="clojure-keyword-face">:id</span><span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="rainbow-delimiters-depth-5-face">(</span>filter func<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span><span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 3, <span class="clojure-keyword-face">:index</span> 3, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\e</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 8, <span class="clojure-keyword-face">:index</span> 14, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\t</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\space</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 10, <span class="clojure-keyword-face">:index</span> 9, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\i</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 12, <span class="clojure-keyword-face">:index</span> 7, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\i</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 24, <span class="clojure-keyword-face">:index</span> 2, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\i</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>tuple-selection <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                          identity
                          <span class="string">&quot;v&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span><span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 8, <span class="clojure-keyword-face">:index</span> 14, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\t</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\space</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 10, <span class="clojure-keyword-face">:index</span> 9, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\i</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>tuple-selection <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                          #<span class="rainbow-delimiters-depth-5-face">(</span>&lt; 7 <span class="rainbow-delimiters-depth-6-face">(</span><span class="clojure-keyword-face">:index</span> <span class="variable-name">%</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
                          <span class="string">&quot;v&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">words-with-sequence</span>
    <span class="doc">&quot;Returns tuples of words matching the given sequence of letters. Each
  matching word only has none or only one tuple popped out.

  The first overload is for easy manual use. The second one exposes full
  options whilst the last overload is recursive and contains the logic.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate letters<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>words-with-sequence substrate
                          <span class="rainbow-delimiters-depth-5-face">(</span><span class="clojure-keyword-face">:position</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-5-face">)</span>
                          letters
                          <span class="rainbow-delimiters-depth-5-face">(</span><span class="clojure-keyword-face">:limit</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-5-face">)</span>
                          <span class="rainbow-delimiters-depth-5-face">(</span><span class="clojure-keyword-face">:case</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate position letters limit case-mode<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-5-face">[</span>pfunc <span class="rainbow-delimiters-depth-6-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-7-face">(</span>number? position<span class="rainbow-delimiters-depth-7-face">)</span>
                   #<span class="rainbow-delimiters-depth-7-face">(</span>= <span class="rainbow-delimiters-depth-8-face">(</span><span class="clojure-keyword-face">:index</span> <span class="variable-name">%</span><span class="rainbow-delimiters-depth-8-face">)</span> position<span class="rainbow-delimiters-depth-7-face">)</span>
                   <span class="rainbow-delimiters-depth-7-face">(</span><span class="clojure-keyword-face">:position</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span>
           <span class="rainbow-delimiters-depth-6-face">[</span>letter second-letter &amp; letters<span class="rainbow-delimiters-depth-6-face">]</span> letters<span class="rainbow-delimiters-depth-5-face">]</span>
       <span class="rainbow-delimiters-depth-5-face">(</span>words-with-sequence substrate
                            second-letter
                            letters
                            case-mode
                            limit
                            <span class="rainbow-delimiters-depth-6-face">(</span>tuple-selection substrate
                                             pfunc
                                             letter
                                             case-mode<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate letter letters case-mode limit result<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">or</span> <span class="rainbow-delimiters-depth-6-face">(</span>nil? letter<span class="rainbow-delimiters-depth-6-face">)</span>
             <span class="rainbow-delimiters-depth-6-face">(</span>empty? result<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
       <span class="rainbow-delimiters-depth-5-face">(</span>take limit result<span class="rainbow-delimiters-depth-5-face">)</span>
       <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">recur</span> substrate
              <span class="rainbow-delimiters-depth-6-face">(</span>first letters<span class="rainbow-delimiters-depth-6-face">)</span>
              <span class="rainbow-delimiters-depth-6-face">(</span>rest letters<span class="rainbow-delimiters-depth-6-face">)</span>
              case-mode
              limit
              <span class="rainbow-delimiters-depth-6-face">(</span>reduce #<span class="rainbow-delimiters-depth-7-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-8-face">(</span><span class="rainbow-delimiters-depth-9-face">(</span>case-match letter case-mode<span class="rainbow-delimiters-depth-9-face">)</span> <span class="rainbow-delimiters-depth-9-face">(</span><span class="clojure-keyword-face">:next</span> <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-9-face">)</span><span class="rainbow-delimiters-depth-8-face">)</span>
                         <span class="rainbow-delimiters-depth-8-face">(</span>conj <span class="variable-name">%</span> <span class="rainbow-delimiters-depth-9-face">(</span>neighboor-tuple substrate <span class="clojure-keyword-face">:next</span> <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-9-face">)</span><span class="rainbow-delimiters-depth-8-face">)</span>
                         <span class="variable-name">%</span><span class="rainbow-delimiters-depth-7-face">)</span>
                      '<span class="rainbow-delimiters-depth-7-face">(</span><span class="rainbow-delimiters-depth-7-face">)</span>
                      result<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span><span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 3, <span class="clojure-keyword-face">:index</span> 3, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\e</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 8, <span class="clojure-keyword-face">:index</span> 14, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\t</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\space</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 10, <span class="clojure-keyword-face">:index</span> 9, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\i</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 12, <span class="clojure-keyword-face">:index</span> 7, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\i</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span>
           <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 24, <span class="clojure-keyword-face">:index</span> 2, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\i</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-with-sequence <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                              identity
                              <span class="string">&quot;v&quot;</span>
                              6
                              <span class="clojure-keyword-face">:relax</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span><span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 26, <span class="clojure-keyword-face">:index</span> 0, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-5-face">}</span> <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 21, <span class="clojure-keyword-face">:index</span> 4, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\n</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-with-sequence <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                              identity
                              <span class="string">&quot;k&quot;</span>
                              5
                              <span class="clojure-keyword-face">:relax</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span><span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 26, <span class="clojure-keyword-face">:index</span> 0, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\a</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-with-sequence <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                              identity
                              <span class="string">&quot;K&quot;</span>
                              4
                              <span class="clojure-keyword-face">:strict</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">current-letter</span>
    <span class="doc">&quot;Tweaky function to get the letter beneath a tuple is which is the
  substrate.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>substrate tuple<span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-4-face">(</span>contains? tuple <span class="clojure-keyword-face">:next</span><span class="rainbow-delimiters-depth-4-face">)</span>
          <span class="rainbow-delimiters-depth-4-face">(</span><span class="clojure-keyword-face">:previous</span> <span class="rainbow-delimiters-depth-5-face">(</span>neighboor-tuple substrate <span class="clojure-keyword-face">:next</span> tuple<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span>
          <span class="rainbow-delimiters-depth-4-face">(</span>contains? tuple <span class="clojure-keyword-face">:previous</span><span class="rainbow-delimiters-depth-4-face">)</span>
          <span class="rainbow-delimiters-depth-4-face">(</span><span class="clojure-keyword-face">:next</span> <span class="rainbow-delimiters-depth-5-face">(</span>neighboor-tuple substrate <span class="clojure-keyword-face">:previous</span> tuple<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>=  <span class="clojure-character-face">\v</span>
          <span class="rainbow-delimiters-depth-4-face">(</span>current-letter <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                          <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 12 <span class="clojure-keyword-face">:index</span> 7 <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\i</span> <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>=  <span class="clojure-character-face">\x</span>
          <span class="rainbow-delimiters-depth-4-face">(</span>current-letter <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                          <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 16 <span class="clojure-keyword-face">:index</span> 7 <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\e</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">full-word</span>
    <span class="doc">&quot;Retrieve the full word from a tuple&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate tuple<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>full-word substrate
                <span class="rainbow-delimiters-depth-5-face">(</span>current-letter substrate tuple<span class="rainbow-delimiters-depth-5-face">)</span>
                tuple<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>substrate initial tuple<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">-&gt;</span> initial
         <span class="rainbow-delimiters-depth-5-face">(</span>full-word substrate <span class="clojure-keyword-face">:next</span> tuple<span class="rainbow-delimiters-depth-5-face">)</span>
         <span class="rainbow-delimiters-depth-5-face">(</span>full-word substrate <span class="clojure-keyword-face">:previous</span> tuple<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>result substrate flag tuple<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-5-face">(</span>contains? tuple flag<span class="rainbow-delimiters-depth-5-face">)</span>
       <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">recur</span> <span class="rainbow-delimiters-depth-6-face">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-7-face">(</span>= flag <span class="clojure-keyword-face">:next</span><span class="rainbow-delimiters-depth-7-face">)</span> <span class="rainbow-delimiters-depth-7-face">(</span>str result <span class="rainbow-delimiters-depth-8-face">(</span><span class="clojure-keyword-face">:next</span> tuple<span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span>
                    <span class="rainbow-delimiters-depth-7-face">(</span>= flag <span class="clojure-keyword-face">:previous</span><span class="rainbow-delimiters-depth-7-face">)</span> <span class="rainbow-delimiters-depth-7-face">(</span>str <span class="rainbow-delimiters-depth-8-face">(</span><span class="clojure-keyword-face">:previous</span> tuple<span class="rainbow-delimiters-depth-8-face">)</span> result<span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span>
              substrate
              flag
              <span class="rainbow-delimiters-depth-6-face">(</span>neighboor-tuple substrate
                               flag
                               tuple<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
       <span class="rainbow-delimiters-depth-5-face">(</span>str result<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="string">&quot;Project free tv Priceline&quot;</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>full-word <span class="rainbow-delimiters-depth-5-face">(</span>construct list-of-words<span class="rainbow-delimiters-depth-5-face">)</span>
                    <span class="rainbow-delimiters-depth-5-face">{</span><span class="clojure-keyword-face">:id</span> 8, <span class="clojure-keyword-face">:index</span> 7, <span class="clojure-keyword-face">:previous</span> <span class="clojure-character-face">\t</span>, <span class="clojure-keyword-face">:next</span> <span class="clojure-character-face">\f</span><span class="rainbow-delimiters-depth-5-face">}</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span><span class="keyword">defn</span> <span class="function-name">set-or-default</span>
  <span class="doc">&quot;Behave just like the usual function get but the key is not present
  then return the value mapped with this key from a default map.&quot;</span>
  <span class="rainbow-delimiters-depth-2-face">[</span>setting settings default<span class="rainbow-delimiters-depth-2-face">]</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>get settings
       setting
       <span class="rainbow-delimiters-depth-3-face">(</span>get default setting<span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span><span class="keyword">defn</span> <span class="function-name">criterion</span>
  <span class="doc">&quot;I needed that criterion to be battle-tested. It may still have
  loopholes but you must find them ^^&quot;</span>
  <span class="rainbow-delimiters-depth-2-face">[</span>items <span class="rainbow-delimiters-depth-3-face">[</span>before after<span class="rainbow-delimiters-depth-3-face">]</span> position<span class="rainbow-delimiters-depth-2-face">]</span>
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-3-face">(</span>empty? items<span class="rainbow-delimiters-depth-3-face">)</span> <span class="constant">nil</span>
        <span class="rainbow-delimiters-depth-3-face">(</span>= 0 position<span class="rainbow-delimiters-depth-3-face">)</span> <span class="rainbow-delimiters-depth-3-face">(</span>vals-comparator <span class="rainbow-delimiters-depth-4-face">(</span>first items<span class="rainbow-delimiters-depth-4-face">)</span> after
                                        <span class="rainbow-delimiters-depth-4-face">[</span>-1 0 <span class="constant">nil</span><span class="rainbow-delimiters-depth-4-face">]</span><span class="rainbow-delimiters-depth-3-face">)</span>
        <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">(</span>count items<span class="rainbow-delimiters-depth-4-face">)</span> position<span class="rainbow-delimiters-depth-3-face">)</span> <span class="rainbow-delimiters-depth-3-face">(</span>vals-comparator <span class="rainbow-delimiters-depth-4-face">(</span>last items<span class="rainbow-delimiters-depth-4-face">)</span> before
                                                    <span class="rainbow-delimiters-depth-4-face">[</span><span class="constant">nil</span> 0 1<span class="rainbow-delimiters-depth-4-face">]</span><span class="rainbow-delimiters-depth-3-face">)</span>
        <span class="rainbow-delimiters-depth-3-face">(</span>not= <span class="rainbow-delimiters-depth-4-face">[</span>before after<span class="rainbow-delimiters-depth-4-face">]</span>
              <span class="rainbow-delimiters-depth-4-face">[</span><span class="rainbow-delimiters-depth-5-face">(</span>nth items <span class="rainbow-delimiters-depth-6-face">(</span>dec position<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
               <span class="rainbow-delimiters-depth-5-face">(</span>nth items position<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">]</span><span class="rainbow-delimiters-depth-3-face">)</span>
        <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-4-face">[</span>pbf <span class="rainbow-delimiters-depth-5-face">(</span>vals-comparator before
                                   <span class="rainbow-delimiters-depth-6-face">(</span>nth items <span class="rainbow-delimiters-depth-7-face">(</span>dec position<span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">]</span>
          <span class="rainbow-delimiters-depth-4-face">(</span>vals-comparator <span class="rainbow-delimiters-depth-5-face">(</span>nth items position<span class="rainbow-delimiters-depth-5-face">)</span> after <span class="rainbow-delimiters-depth-5-face">[</span>-1 <span class="rainbow-delimiters-depth-6-face">(</span>- pbf<span class="rainbow-delimiters-depth-6-face">)</span> 1<span class="rainbow-delimiters-depth-5-face">]</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
        <span class="clojure-keyword-face">:else</span> 0<span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span><span class="keyword">deftest</span> <span class="function-name">test-criterion</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span>-1 -1 -1 0<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>0 0 0<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 4<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span>0 1 1 1<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>0 0 0<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>-1 0<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 4<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span>-1 -1 -1 <span class="constant">nil</span><span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>0 0 0<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>1 2<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 4<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span><span class="constant">nil</span> 1 1 1<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>0 0 0<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>-2 -1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 4<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span>-1 -1 0 1<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>0 0 1<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 4<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span>-1 0 1 1<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>0 1 1<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 4<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span>0 1 1 1<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>1 1 1<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 4<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span>-1 0<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>0<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 2<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span>0 1<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>1<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 2<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span><span class="constant">nil</span> 1<span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span>2<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 2<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= '<span class="rainbow-delimiters-depth-4-face">(</span><span class="constant">nil</span><span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>map <span class="rainbow-delimiters-depth-5-face">(</span>partial criterion <span class="rainbow-delimiters-depth-6-face">[</span><span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">(</span>range 1<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span><span class="keyword">defn</span> <span class="function-name">find-threshold</span>
  <span class="doc">&quot;[ before after [. Used in conjunction with subvec. before &lt; after and
  items are &lt;= sorted.&quot;</span>
  <span class="rainbow-delimiters-depth-2-face">[</span>items comparator<span class="rainbow-delimiters-depth-2-face">]</span>
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3-face">(</span>empty? items<span class="rainbow-delimiters-depth-3-face">)</span> <span class="constant">nil</span>
      <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">loop</span> <span class="rainbow-delimiters-depth-4-face">[</span>position <span class="rainbow-delimiters-depth-5-face">(</span>ifloor <span class="rainbow-delimiters-depth-6-face">(</span>/ <span class="rainbow-delimiters-depth-7-face">(</span>count items<span class="rainbow-delimiters-depth-7-face">)</span> 2<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
             step <span class="rainbow-delimiters-depth-5-face">(</span>iceil <span class="rainbow-delimiters-depth-6-face">(</span>/ <span class="rainbow-delimiters-depth-7-face">(</span>count items<span class="rainbow-delimiters-depth-7-face">)</span> 4<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">]</span>
        <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">case</span> <span class="rainbow-delimiters-depth-5-face">(</span>comparator position<span class="rainbow-delimiters-depth-5-face">)</span>
          -1 <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">recur</span> <span class="rainbow-delimiters-depth-6-face">(</span>min <span class="rainbow-delimiters-depth-7-face">(</span>identity <span class="rainbow-delimiters-depth-8-face">(</span>count items<span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span> <span class="rainbow-delimiters-depth-7-face">(</span>+ step position<span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span>
                    <span class="rainbow-delimiters-depth-6-face">(</span>int <span class="rainbow-delimiters-depth-7-face">(</span>iround <span class="rainbow-delimiters-depth-8-face">(</span>/ step 2<span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
          0 <span class="rainbow-delimiters-depth-5-face">(</span>iround position<span class="rainbow-delimiters-depth-5-face">)</span>
          1 <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">recur</span> <span class="rainbow-delimiters-depth-6-face">(</span>max 0 <span class="rainbow-delimiters-depth-7-face">(</span>- position step<span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span>
                   <span class="rainbow-delimiters-depth-6-face">(</span>int <span class="rainbow-delimiters-depth-7-face">(</span>iround <span class="rainbow-delimiters-depth-8-face">(</span>/ step 2<span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
          <span class="constant">nil</span> <span class="constant">nil</span>
          <span class="clojure-keyword-face">:else</span> 'unexpected-stop<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span><span class="keyword">defn-</span> <span class="function-name">verify-find-threshold</span>
  <span class="doc">&quot;Same for threshold. I was willing to make as most sure as possible
  it's correct and won't speak out from time to time because of a bug.

  Rely upon the criteria. Here we use criteria to figure out whether the
  tentative index computed elsewhere is correct. To be used in test only
  as a check.&quot;</span>
  <span class="rainbow-delimiters-depth-2-face">[</span>items threshold index<span class="rainbow-delimiters-depth-2-face">]</span>
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">-&gt;&gt;</span> threshold
           <span class="rainbow-delimiters-depth-4-face">(</span>map #<span class="rainbow-delimiters-depth-5-face">(</span>some <span class="rainbow-delimiters-depth-6-face">(</span>partial = <span class="variable-name">%</span><span class="rainbow-delimiters-depth-6-face">)</span> items<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span>
           <span class="rainbow-delimiters-depth-4-face">(</span>every? false?<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="constant">nil</span> index<span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-4-face">[</span>items <span class="rainbow-delimiters-depth-5-face">(</span>conj <span class="rainbow-delimiters-depth-6-face">(</span>vec items<span class="rainbow-delimiters-depth-6-face">)</span> <span class="rainbow-delimiters-depth-6-face">(</span>last threshold<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">]</span>
      <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">-&gt;&gt;</span> <span class="rainbow-delimiters-depth-5-face">(</span>range <span class="rainbow-delimiters-depth-6-face">(</span>count items<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
           <span class="rainbow-delimiters-depth-5-face">(</span>map <span class="rainbow-delimiters-depth-6-face">(</span>partial criterion items threshold<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
           <span class="rainbow-delimiters-depth-5-face">(</span>map-indexed vector<span class="rainbow-delimiters-depth-5-face">)</span>
           <span class="rainbow-delimiters-depth-5-face">(</span>drop-while #<span class="rainbow-delimiters-depth-6-face">(</span>not= 0 <span class="rainbow-delimiters-depth-7-face">(</span>last <span class="variable-name">%</span><span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
           ffirst
           <span class="rainbow-delimiters-depth-5-face">(</span>= index<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span><span class="keyword">deftest</span> <span class="function-name">test-find-threshold-dicho</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>testing <span class="string">&quot;Only the dichotomia itself and nothing else thus we can rely
upon the criterion. Bulk tests.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">for</span> <span class="rainbow-delimiters-depth-4-face">[</span>a <span class="rainbow-delimiters-depth-5-face">(</span>range 3<span class="rainbow-delimiters-depth-5-face">)</span>
          b <span class="rainbow-delimiters-depth-5-face">(</span>range 3<span class="rainbow-delimiters-depth-5-face">)</span>
          c <span class="rainbow-delimiters-depth-5-face">(</span>range 3<span class="rainbow-delimiters-depth-5-face">)</span>
          threshold '<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">[</span>-2 -1<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>-1 0<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>1 2<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>2 3<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">]</span>
      <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-5-face">[</span>repartition <span class="rainbow-delimiters-depth-6-face">[</span><span class="rainbow-delimiters-depth-7-face">[</span><span class="rainbow-delimiters-depth-8-face">(</span>inc a<span class="rainbow-delimiters-depth-8-face">)</span> -1<span class="rainbow-delimiters-depth-7-face">]</span> <span class="rainbow-delimiters-depth-7-face">[</span><span class="rainbow-delimiters-depth-8-face">(</span>inc b<span class="rainbow-delimiters-depth-8-face">)</span> 0<span class="rainbow-delimiters-depth-7-face">]</span> <span class="rainbow-delimiters-depth-7-face">[</span><span class="rainbow-delimiters-depth-8-face">(</span>inc c<span class="rainbow-delimiters-depth-8-face">)</span> 1<span class="rainbow-delimiters-depth-7-face">]</span><span class="rainbow-delimiters-depth-6-face">]</span>
            items <span class="rainbow-delimiters-depth-6-face">(</span>mapcat #<span class="rainbow-delimiters-depth-7-face">(</span>repeat <span class="rainbow-delimiters-depth-8-face">(</span>first <span class="variable-name">%</span><span class="rainbow-delimiters-depth-8-face">)</span> <span class="rainbow-delimiters-depth-8-face">(</span>last <span class="variable-name">%</span><span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span> repartition<span class="rainbow-delimiters-depth-6-face">)</span>
            comparator <span class="rainbow-delimiters-depth-6-face">(</span>partial criterion items threshold<span class="rainbow-delimiters-depth-6-face">)</span>
            tentative-index <span class="rainbow-delimiters-depth-6-face">(</span>find-threshold items comparator<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">]</span>
        <span class="rainbow-delimiters-depth-5-face">(</span>is <span class="rainbow-delimiters-depth-6-face">(</span>verify-find-threshold items
                                   threshold
                                   tentative-index<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">interval-from-thresholds</span>
    <span class="doc">&quot;Take a collection and returns the indices for the thresholds.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>items <span class="rainbow-delimiters-depth-4-face">[</span>start stop<span class="rainbow-delimiters-depth-4-face">]</span><span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-4-face">[</span>lower-index <span class="rainbow-delimiters-depth-5-face">(</span>find-threshold items <span class="rainbow-delimiters-depth-6-face">(</span>partial criterion
                                                     items start<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
          upper-index <span class="rainbow-delimiters-depth-5-face">(</span>find-threshold items <span class="rainbow-delimiters-depth-6-face">(</span>partial criterion
                                                     items stop<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">]</span>
      <span class="rainbow-delimiters-depth-4-face">(</span>vector lower-index upper-index<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span>2 6<span class="rainbow-delimiters-depth-4-face">]</span> <span class="rainbow-delimiters-depth-4-face">(</span>interval-from-thresholds <span class="rainbow-delimiters-depth-5-face">(</span>vec <span class="rainbow-delimiters-depth-6-face">(</span>range 10<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
                                         <span class="rainbow-delimiters-depth-5-face">[</span><span class="rainbow-delimiters-depth-6-face">[</span>1 2<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>5 6<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">]</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span>4 <span class="constant">nil</span><span class="rainbow-delimiters-depth-4-face">]</span> <span class="rainbow-delimiters-depth-4-face">(</span>interval-from-thresholds <span class="rainbow-delimiters-depth-5-face">(</span>range 25<span class="rainbow-delimiters-depth-5-face">)</span> <span class="rainbow-delimiters-depth-5-face">[</span><span class="rainbow-delimiters-depth-6-face">[</span>3 4<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>30 31<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">]</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span><span class="keyword">defn</span> <span class="function-name">project-and-select</span>
  <span class="doc">&quot;Basically a wrapper for interval-from-thresholds but return actual
  words matching the criterion (so you can use them).&quot;</span>
  <span class="rainbow-delimiters-depth-2-face">[</span>project words<span class="rainbow-delimiters-depth-2-face">]</span>
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">and</span> <span class="rainbow-delimiters-depth-4-face">(</span>= 1 <span class="rainbow-delimiters-depth-5-face">(</span>count words<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span> <span class="rainbow-delimiters-depth-4-face">(</span>= 0 <span class="rainbow-delimiters-depth-5-face">(</span>project <span class="rainbow-delimiters-depth-6-face">(</span>first words<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    words
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-4-face">[</span>data <span class="rainbow-delimiters-depth-5-face">(</span>sort #<span class="rainbow-delimiters-depth-6-face">(</span>vals-comparator <span class="rainbow-delimiters-depth-7-face">(</span>project <span class="variable-name">%</span><span class="rainbow-delimiters-depth-7-face">)</span> <span class="rainbow-delimiters-depth-7-face">(</span>project <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span>
                     words<span class="rainbow-delimiters-depth-5-face">)</span>
          nil-bounds <span class="rainbow-delimiters-depth-5-face">(</span>fnil <span class="rainbow-delimiters-depth-6-face">(</span>partial subvec <span class="rainbow-delimiters-depth-7-face">(</span>vec data<span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span> 0 <span class="rainbow-delimiters-depth-6-face">(</span>count data<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
          extract <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">fn</span> <span class="rainbow-delimiters-depth-6-face">[</span>lower upper<span class="rainbow-delimiters-depth-6-face">]</span>
                    <span class="rainbow-delimiters-depth-6-face">(</span><span class="keyword">if</span> <span class="rainbow-delimiters-depth-7-face">(</span>= <span class="rainbow-delimiters-depth-8-face">[</span>lower upper<span class="rainbow-delimiters-depth-8-face">]</span> <span class="rainbow-delimiters-depth-8-face">[</span><span class="constant">nil</span> <span class="constant">nil</span><span class="rainbow-delimiters-depth-8-face">]</span><span class="rainbow-delimiters-depth-7-face">)</span> <span class="rainbow-delimiters-depth-7-face">[</span><span class="rainbow-delimiters-depth-7-face">]</span>
                        <span class="rainbow-delimiters-depth-7-face">(</span>nil-bounds lower upper<span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">]</span>
      <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">-&gt;&gt;</span> <span class="rainbow-delimiters-depth-5-face">[</span><span class="rainbow-delimiters-depth-6-face">[</span>-1 0<span class="rainbow-delimiters-depth-6-face">]</span> <span class="rainbow-delimiters-depth-6-face">[</span>0 1<span class="rainbow-delimiters-depth-6-face">]</span><span class="rainbow-delimiters-depth-5-face">]</span>
           <span class="rainbow-delimiters-depth-5-face">(</span>interval-from-thresholds <span class="rainbow-delimiters-depth-6-face">(</span>map project data<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
           <span class="rainbow-delimiters-depth-5-face">(</span>apply extract<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">words-with-letter-dicho</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>words letter<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>project-and-select <span class="rainbow-delimiters-depth-5-face">(</span>letter-in-word letter<span class="rainbow-delimiters-depth-5-face">)</span> words<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>words position letter<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>project-and-select <span class="rainbow-delimiters-depth-5-face">(</span>letter-at-position-in-word letter
                                                     position<span class="rainbow-delimiters-depth-5-face">)</span>
                         words<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>= '<span class="rainbow-delimiters-depth-3-face">(</span><span class="string">&quot;i&quot;</span> <span class="string">&quot;ia&quot;</span><span class="rainbow-delimiters-depth-3-face">)</span> <span class="rainbow-delimiters-depth-3-face">(</span>words-with-letter-dicho '<span class="rainbow-delimiters-depth-4-face">(</span><span class="string">&quot;i&quot;</span> <span class="string">&quot;ia&quot;</span> <span class="string">&quot;ai&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span> 0 <span class="clojure-character-face">\i</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>= '<span class="rainbow-delimiters-depth-3-face">(</span><span class="string">&quot;bi&quot;</span> <span class="string">&quot;ai&quot;</span><span class="rainbow-delimiters-depth-3-face">)</span> <span class="rainbow-delimiters-depth-3-face">(</span>words-with-letter-dicho '<span class="rainbow-delimiters-depth-4-face">(</span><span class="string">&quot;bi&quot;</span> <span class="string">&quot;ia&quot;</span> <span class="string">&quot;ai&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span> 1 <span class="clojure-character-face">\i</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>= '<span class="rainbow-delimiters-depth-3-face">(</span><span class="string">&quot;i&quot;</span> <span class="string">&quot;ia&quot;</span> <span class="string">&quot;ai&quot;</span><span class="rainbow-delimiters-depth-3-face">)</span> <span class="rainbow-delimiters-depth-3-face">(</span>words-with-letter-dicho '<span class="rainbow-delimiters-depth-4-face">(</span><span class="string">&quot;i&quot;</span> <span class="string">&quot;ia&quot;</span> <span class="string">&quot;ai&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span> <span class="clojure-character-face">\i</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">words-start-with-sequence-dicho</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>words letters<span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span>reduce #<span class="rainbow-delimiters-depth-4-face">(</span>words-with-letter-dicho <span class="variable-name">%</span>
                                      <span class="rainbow-delimiters-depth-5-face">(</span>first <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-5-face">)</span>
                                      <span class="rainbow-delimiters-depth-5-face">(</span>second <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span>
            words
            <span class="rainbow-delimiters-depth-4-face">(</span>sort #<span class="rainbow-delimiters-depth-5-face">(</span><span class="rainbow-delimiters-depth-6-face">(</span>rarest-letter<span class="rainbow-delimiters-depth-6-face">)</span> <span class="rainbow-delimiters-depth-6-face">(</span>second <span class="variable-name">%1</span><span class="rainbow-delimiters-depth-6-face">)</span> <span class="rainbow-delimiters-depth-6-face">(</span>second <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span>
                  <span class="rainbow-delimiters-depth-5-face">(</span>map-indexed vector letters<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="string">&quot;lax&quot;</span> <span class="string">&quot;laxative&quot;</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-start-with-sequence-dicho '<span class="rainbow-delimiters-depth-5-face">(</span><span class="string">&quot;lax&quot;</span> <span class="string">&quot;laxative&quot;</span> <span class="string">&quot;lexomil&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span>
                                          <span class="string">&quot;la&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-start-with-sequence-dicho '<span class="rainbow-delimiters-depth-5-face">(</span><span class="string">&quot;lax&quot;</span> <span class="string">&quot;laxative&quot;</span> <span class="string">&quot;lexomil&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span>
                                          <span class="string">&quot;w&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">words-contain-unordered-set-of-letters-dicho</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>words letters<span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span>reduce words-with-letter-dicho
            words
            <span class="rainbow-delimiters-depth-4-face">(</span>distinct <span class="rainbow-delimiters-depth-5-face">(</span>sort <span class="rainbow-delimiters-depth-6-face">(</span>rarest-letter<span class="rainbow-delimiters-depth-6-face">)</span> letters<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="string">&quot;abcde&quot;</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-contain-unordered-set-of-letters-dicho
          '<span class="rainbow-delimiters-depth-5-face">(</span><span class="string">&quot;ab&quot;</span> <span class="string">&quot;abc&quot;</span> <span class="string">&quot;abcd&quot;</span> <span class="string">&quot;abcde&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="string">&quot;ea&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="string">&quot;abc&quot;</span> <span class="string">&quot;abcd&quot;</span> <span class="string">&quot;abcde&quot;</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-contain-unordered-set-of-letters-dicho
          '<span class="rainbow-delimiters-depth-5-face">(</span><span class="string">&quot;ab&quot;</span> <span class="string">&quot;abc&quot;</span> <span class="string">&quot;abcd&quot;</span> <span class="string">&quot;abcde&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="string">&quot;c&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">words-anagrams-of-dicho</span>
    <span class="rainbow-delimiters-depth-3-face">[</span>words letters<span class="rainbow-delimiters-depth-3-face">]</span>
    <span class="rainbow-delimiters-depth-3-face">(</span>reduce #<span class="rainbow-delimiters-depth-4-face">(</span>project-and-select <span class="rainbow-delimiters-depth-5-face">(</span>letter-in-word <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="variable-name">%</span><span class="rainbow-delimiters-depth-4-face">)</span>
            <span class="rainbow-delimiters-depth-4-face">(</span>project-and-select <span class="rainbow-delimiters-depth-5-face">(</span>same-length letters<span class="rainbow-delimiters-depth-5-face">)</span> words<span class="rainbow-delimiters-depth-4-face">)</span>
            <span class="rainbow-delimiters-depth-4-face">(</span>sort <span class="rainbow-delimiters-depth-5-face">(</span>rarest-letter<span class="rainbow-delimiters-depth-5-face">)</span> letters<span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="string">&quot;apers&quot;</span> <span class="string">&quot;apres&quot;</span> <span class="string">&quot;asper&quot;</span> <span class="string">&quot;pares&quot;</span> <span class="string">&quot;parse&quot;</span> <span class="string">&quot;pears&quot;</span>
          <span class="string">&quot;rapes&quot;</span> <span class="string">&quot;reaps&quot;</span> <span class="string">&quot;spare&quot;</span> <span class="string">&quot;spear&quot;</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-anagrams-of-dicho <span class="rainbow-delimiters-depth-5-face">[</span><span class="string">&quot;apers&quot;</span> <span class="string">&quot;apres&quot;</span> <span class="string">&quot;asper&quot;</span> <span class="string">&quot;pares&quot;</span>
                                   <span class="string">&quot;parse&quot;</span> <span class="string">&quot;pears&quot;</span> <span class="string">&quot;rapes&quot;</span>
                                   <span class="string">&quot;reaps&quot;</span> <span class="string">&quot;spare&quot;</span> <span class="string">&quot;spear&quot;</span><span class="rainbow-delimiters-depth-5-face">]</span>
                                  <span class="string">&quot;aeprs&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="string">&quot;abc&quot;</span> <span class="string">&quot;cba&quot;</span> <span class="string">&quot;acb&quot;</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-anagrams-of-dicho '<span class="rainbow-delimiters-depth-5-face">(</span><span class="string">&quot;abc&quot;</span> <span class="string">&quot;cba&quot;</span> <span class="string">&quot;acb&quot;</span> <span class="string">&quot;aze&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="string">&quot;cab&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">words-contain-sequence-dicho</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>words letters<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>words-contain-sequence-dicho
      words letters
      <span class="rainbow-delimiters-depth-5-face">(</span><span class="clojure-keyword-face">:laxity</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-5-face">)</span>
      <span class="rainbow-delimiters-depth-5-face">(</span><span class="clojure-keyword-face">:case</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>words letters laxity case-mode<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>reduce #<span class="rainbow-delimiters-depth-5-face">(</span>project-and-select <span class="rainbow-delimiters-depth-6-face">(</span>retro <span class="rainbow-delimiters-depth-7-face">(</span>nth letters <span class="rainbow-delimiters-depth-8-face">(</span>dec <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span>
                                         <span class="rainbow-delimiters-depth-7-face">(</span>nth letters <span class="variable-name">%2</span><span class="rainbow-delimiters-depth-7-face">)</span>
                                         case-mode
                                         laxity<span class="rainbow-delimiters-depth-6-face">)</span> <span class="variable-name">%</span><span class="rainbow-delimiters-depth-5-face">)</span>
             <span class="rainbow-delimiters-depth-5-face">(</span>project-and-select
              <span class="rainbow-delimiters-depth-6-face">(</span>letter-in-word <span class="rainbow-delimiters-depth-7-face">(</span><span class="keyword">-&gt;&gt;</span> letters
                                   <span class="rainbow-delimiters-depth-8-face">(</span>sort <span class="rainbow-delimiters-depth-9-face">(</span>rarest-letter<span class="rainbow-delimiters-depth-9-face">)</span><span class="rainbow-delimiters-depth-8-face">)</span>
                                   first<span class="rainbow-delimiters-depth-7-face">)</span>
                              case-mode<span class="rainbow-delimiters-depth-6-face">)</span>
              words<span class="rainbow-delimiters-depth-5-face">)</span>
             <span class="rainbow-delimiters-depth-5-face">(</span>range 1 <span class="rainbow-delimiters-depth-6-face">(</span>count letters<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="string">&quot;abc&quot;</span> <span class="string">&quot;abd&quot;</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-contain-sequence-dicho '<span class="rainbow-delimiters-depth-5-face">(</span><span class="string">&quot;abc&quot;</span> <span class="string">&quot;abd&quot;</span> <span class="string">&quot;bde&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="string">&quot;ab&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>is <span class="rainbow-delimiters-depth-3-face">(</span>= <span class="rainbow-delimiters-depth-4-face">[</span><span class="string">&quot;abd&quot;</span> <span class="string">&quot;bde&quot;</span><span class="rainbow-delimiters-depth-4-face">]</span>
         <span class="rainbow-delimiters-depth-4-face">(</span>words-contain-sequence-dicho '<span class="rainbow-delimiters-depth-5-face">(</span><span class="string">&quot;abc&quot;</span> <span class="string">&quot;abd&quot;</span> <span class="string">&quot;bde&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span> <span class="string">&quot;bd&quot;</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>

<span class="rainbow-delimiters-depth-1-face">(</span>with-test
  <span class="rainbow-delimiters-depth-2-face">(</span><span class="keyword">defn</span> <span class="function-name">words-contain-sequence-at-dicho</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>words position letters<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span>words-contain-sequence-at-dicho
      words position letters
      <span class="rainbow-delimiters-depth-5-face">(</span><span class="clojure-keyword-face">:laxity</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-5-face">)</span>
      <span class="rainbow-delimiters-depth-5-face">(</span><span class="clojure-keyword-face">:case</span> autocomplete-default-settings<span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span>
    <span class="rainbow-delimiters-depth-3-face">(</span><span class="rainbow-delimiters-depth-4-face">[</span>words position letters laxity case-mode<span class="rainbow-delimiters-depth-4-face">]</span>
     <span class="rainbow-delimiters-depth-4-face">(</span><span class="keyword">let</span> <span class="rainbow-delimiters-depth-5-face">[</span>sieve <span class="rainbow-delimiters-depth-6-face">(</span><span class="keyword">cond</span> <span class="rainbow-delimiters-depth-7-face">(</span>= identity position<span class="rainbow-delimiters-depth-7-face">)</span>
                       identity
                       <span class="rainbow-delimiters-depth-7-face">(</span>number? position<span class="rainbow-delimiters-depth-7-face">)</span>
                       #<span class="rainbow-delimiters-depth-7-face">(</span>words-with-letter-dicho <span class="variable-name">%</span> position
                                                 <span class="rainbow-delimiters-depth-8-face">(</span>first letters<span class="rainbow-delimiters-depth-8-face">)</span><span class="rainbow-delimiters-depth-7-face">)</span><span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">]</span>
       <span class="rainbow-delimiters-depth-5-face">(</span><span class="keyword">-&gt;</span> words
           sieve
           <span class="rainbow-delimiters-depth-6-face">(</span>words-contain-sequence-dicho letters laxity case-mode<span class="rainbow-delimiters-depth-6-face">)</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span>
  <span class="rainbow-delimiters-depth-2-face">(</span>testing <span class="string">&quot;only the position as default behaviour has been tested in
  another function.&quot;</span>
    <span class="rainbow-delimiters-depth-3-face">(</span>is <span class="rainbow-delimiters-depth-4-face">(</span>= <span class="rainbow-delimiters-depth-5-face">[</span><span class="string">&quot;porphyrogenese&quot;</span> <span class="string">&quot;porc&quot;</span><span class="rainbow-delimiters-depth-5-face">]</span>
           <span class="rainbow-delimiters-depth-5-face">(</span>words-contain-sequence-at-dicho '<span class="rainbow-delimiters-depth-6-face">(</span><span class="string">&quot;porphyrogenese&quot;</span> <span class="string">&quot;porc&quot;</span> <span class="string">&quot;non&quot;</span><span class="rainbow-delimiters-depth-6-face">)</span>
                                            1 <span class="string">&quot;or&quot;</span><span class="rainbow-delimiters-depth-5-face">)</span><span class="rainbow-delimiters-depth-4-face">)</span><span class="rainbow-delimiters-depth-3-face">)</span><span class="rainbow-delimiters-depth-2-face">)</span><span class="rainbow-delimiters-depth-1-face">)</span>
</pre>

 </body>
</html>
